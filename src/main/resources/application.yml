spring:
  application:
    name: sentinelpay-fraud-engine
  profiles:
    active: dev

---
# Development profile - For local IntelliJ + Docker services
spring:
  config:
    activate:
      on-profile: dev

  # R2DBC configuration for Postgres (Reactive) - FIXED HOST
  r2dbc:
    url: r2dbc:postgresql://localhost:15432/frauddb
    username: fraud_user
    password: fraud_password
    pool:
      initial-size: 5
      max-size: 20
      max-idle-time: 30m

  # Redis configuration
  data:
    redis:
      host: localhost
      port: 6379
      password: sentinelpay123
      lettuce:
        pool:
          max-active: 10
          max-idle: 5
          min-idle: 2

  # Kafka configuration
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      properties:
        spring.json.trusted.packages: "*"
    properties:
      # Pre-warm producer connections
      connections.max.idle.ms: 540000
      metadata.max.age.ms: 300000

  # Scheduling Configuration
  task:
    scheduling:
      enabled: true

  # Exclude Cassandra autoconfiguration
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration

# Management & Health
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

---
# Resilience4j Configuration
resilience4j:
  circuitbreaker:
    instances:
      mlService:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10s
      ruleEngine:
        sliding-window-size: 20
        failure-rate-threshold: 30
        wait-duration-in-open-state: 5s
      fraudEngine:
        sliding-window-size: 20
        failure-rate-threshold: 20
        wait-duration-in-open-state: 5s
  timelimiter:
    instances:
      mlService:
        timeout-duration: 5s
      ruleEngine:
        timeout-duration: 500ms
      fraudEngine:
        timeout-duration: 10s
  # Rate Limiting Configuration (NEW)
  ratelimiter:
    instances:
      fraudApi:
        limit-for-period: 60
        limit-refresh-period: 1m
        timeout-duration: 0
        allow-health-indicator-to-fail: false
        subscribe-for-events: true

---
# Logging Configuration
logging:
  level:
    com.sentinelpay.fraudengine: DEBUG
    com.sentinelpay.fraudengine.service: DEBUG
    org.springframework.data.r2dbc: WARN
    io.github.resilience4j: INFO
    org.apache.kafka: WARN

---
# Server Configuration
server:
  port: 8080

---
# Application-specific configurations (FIXED SECTION)
# TensorFlow Model Path
tensorflow:
  model:
    path: "src/main/resources/models/fraud_model"

# Alerting Configuration (Slack, Email, Phone)
alerts:
  slack:
    webhook: ""
  email:
    endpoint: ""
  fraud-team:
    phone: "${FRAUD_TEAM_PHONE:}"

# ML Training Service Configuration
ml:
  training:
    service:
      url: "http://localhost:8000"
  retraining:
    enabled: true

# Fraud Detection Configuration
fraud:
  detection:
    risk-threshold:
      block: 0.8
      review: 0.4
    rules:
      enabled: true
      custom-rules-path: "classpath:rules/"

# Security Configuration (NEW)
security:
  jwt:
    secret: "${JWT_SECRET:your-super-secret-jwt-key-min-256-bits-long-for-sentinelpay-fraud-engine}"
    expiration: 86400000 # 24 hours in milliseconds

# CORS Configuration (NEW)
cors:
  allowed-origins: "http://localhost:3000,https://your-frontend.com"
  allowed-methods: "GET,POST,PUT,DELETE,OPTIONS"
  allowed-headers: "*"
  allow-credentials: true
  max-age: 3600